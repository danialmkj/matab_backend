from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from rest_framework.permissions import AllowAny
from .models import Doctor
from .serializers import DoctorSerializer

# ==========================================
# پایگاه دانش جامع (۲۰۵ مورد)
# ==========================================
MEDICAL_KNOWLEDGE = {
    # --- تیم توسعه (Easter Eggs) ---
    'مانی حامی': 'تو بهترین ui کار جهانی',
    'فرامرز': 'تو هیچییی نیسی جوجه',
    'آرش': 'تو بهترین بک اند کار جهانی',
    'دانیال': 'تو بهترین فرانت کار جهانی',
    'سلام': 'سلام من هوش مصنوعی مطب هستم چه سوالی دارید ؟',

    # --- پزشکی عمومی و علائم ---
    'دل‌درد': 'دل‌درد می‌تواند از نفخ یا عفونت باشد. استراحت کنید، آب بنوشید و اگر شدید است به پزشک بروید.',
    'سر درد': 'سردرد اغلب از استرس یا کم‌آبی می‌آید. مسکن مثل ایبوپروفن بخورید اما اگر مداوم است چکاپ کنید.',
    'تب': 'تب نشانه عفونت است. دمای بالای ۳۸ درجه را با پاراستامول کنترل کنید و اگر بیش از ۲ روز طول کشید به پزشک بروید.',
    'سرفه خشک': 'سرفه خشک می‌تواند از آلرژی باشد. مایعات زیاد بنوشید و عسل با آب گرم امتحان کنید، اگر خونی شد فوری به پزشک.',
    'تهوع': 'تهوع از غذای نامناسب می‌آید. غذاهای سبک مثل نان تست بخورید و زنجبیل دم کنید، اگر استفراغ مداوم اورژانس.',
    'خستگی': 'خستگی می‌تواند از کمبود خواب یا کم‌خونی باشد. رژیم متعادل و ورزش سبک کمک می‌کند، آزمایش خون پیشنهاد می‌شود.',
    'کمر درد': 'درد کمر اغلب از نشستن طولانی است. کمپرس گرم بگذارید و حرکات کششی انجام دهید، اگر تیر می‌کشد عکس‌برداری لازم.',
    'جوش صورت': 'جوش‌ها از چربی پوست می‌آیند. صورت را با صابون ملایم بشویید و چای سبز بزنید، برای موارد شدید متخصص پوست.',
    'یبوست': 'یبوست از کمبود فیبر است. میوه‌ها مثل سیب و آب زیاد بخورید، ملین‌های ملایم مثل پسیلیوم امتحان کنید.',
    'اسهال': 'اسهال از عفونت می‌آید. هیدراته بمانید، ORS بنوشید و اگر خونی یا طولانی به پزشک.',
    'قفسه سینه': 'درد قفسه سینه می‌تواند از عضله یا قلب باشد. فوری استراحت کنید و اگر با تنگی نفس اورژانس تماس بگیرید.',
    'آبریزش بینی': 'بله اغلب سرماخوردگی یا آلرژی. بخار آب دم کنید و داروهای ضدآلرژی بخورید، اگر سبز شد عفونت باکتریایی.',
    'دندون‌درد': 'دندون‌درد از پوسیدگی است. نمک آب گرم غرغره کنید و مسکن بخورید، سریع به دندانپزشک بروید.',
    'کمر درد شبانه': 'می‌تواند از دیسک یا آرتروز باشد. تشک سفت استفاده کنید و فیزیوتراپی، اگر بی‌حسی چکاپ.',
    'وزن کم': 'کاهش وزن ناگهانی از تیروئید یا سرطان می‌تواند باشد. رژیم و ورزش چک کنید، آزمایش کامل لازم.',
    'گلو درد': 'گلو درد از ویروس یا باکتری. آب نمک غرغره کنید و لوسیون بمکید، اگر سفیدک آنتی‌بیوتیک.',
    'لرزش دست': 'لرزش از استرس یا قند خون می‌تواند. کافئین کم کنید، اگر مداوم متخصص مغز و اعصاب.',
    'چشم قرمز': 'قرمزی از آلرژی یا التهاب ملتحمه. قطره اشک مصنوعی بزنید، اگر درد چشم‌پزشک.',
    'نفخ': 'نفخ از غذاهای سنگین. پروبیوتیک و پیاده‌روی کمک می‌کند، اگر درد شدید متخصص گوارش.',
    'ریزش مو': 'ریزش مو از استرس یا کمبود آهن. ویتامین B و بیوتین بخورید، آزمایش هورمون.',
    'مفاصل': 'درد مفاصل از التهاب یا سن. یخ بگذارید و امگا-۳ بخورید، متخصص روماتولوژی.',
    'بی‌خوابی': 'بی‌خوابی از استرس. روتین خواب بسازید، چای بابونه، اگر مزمن روانپزشک.',
    'پوست خشک': 'خشکی از هوا یا اگزما. لوسیون بدون عطر بزنید، اگر ترک متخصص پوست.',
    'حافظه': 'فراموشی از سن یا کمبود ویتامین. پازل حل کنید و امگا-۳، تست شناختی.',
    'درد معده': 'درد معده از زخم یا ریفلاکس. غذاهای تند اجتناب کنید، آندوسکوپی.',
    'تنگی نفس': 'تنگی نفس از آسم یا اضطراب. inhaler اگر تجویز شده، اگر ناگهانی اورژانس.',
    'ناخن': 'شکنندگی از بیوتین یا تیروئید. ژلاتین و کلسیم بخورید، آزمایش.',
    'عرق سرد': 'عرق سرد از عفونت یا افت قند. گرم بمانید و چک قند، اگر با درد فوری.',
    'گوش‌درد': 'گوش‌درد از عفونت. قطره گرم روغن بزنید، اگر تب متخصص گوش و حلق و بینی.',
    'ورم پا': 'ورم از نمک یا نارسایی قلب. پاها را بالا ببرید، اکوکاردیوگرام.',
    'حساسیت': 'حساسیت از مواد. آنتی‌هیستامین بخورید، تست آلرژی.',
    'دهن تلخ': 'طعم تلخ از ریفلاکس. مسواک بزنید و آب لیمو، چک گوارش.',
    'درد گردن': 'درد گردن از وضعیت بد. کشش کنید، اگر بی‌حسی عکس‌برداری.',
    'اشتها': 'بی‌اشتهایی از افسردگی یا بیماری. غذاهای مورد علاقه، روانشناس.',
    'خارش بدن': 'خارش از آلرژی. حمام سرد و آنتی‌هیستامین، اگر مداوم متخصص پوست.',
    'قاعدگی': 'نامنظمی از استرس یا کیست تخمدان. تقویم بزنید، متخصص زنان.',
    'سوزش ادرار': 'سوزش از عفونت ادراری. آب زیاد و آب زغال‌اخته، آزمایش ادرار.',
    'ضعف عضلانی': 'ضعف از پتاسیم یا بیماری اعصاب. موز بخورید، متخصص مغز و اعصاب.',
    'بوی دهان': 'بوی بد از بهداشت یا عفونت. نخ دندان و دهان‌شویه، دندانپزشک.',
    'میگرن': 'میگرن از نور یا غذا. تاریک بمانید و مسکن، متخصص سردرد.',
    'راش پوستی': 'راش از ویروس یا آلرژی. کالامین بزنید، اگر تب پزشک.',
    'درد بیضه': 'درد بیضه از پیچش. فوری اورژانس، خودآزمایی منظم.',
    'گرفتگی بینی': 'گرفتگی از سرماخوردگی. بخار و اسپری نمکی، اگر درد آنتی‌بیوتیک.',
    'بارداری': 'بله از وزن. کمربند حمایتی، فیزیوتراپی بارداری.',
    'زردی چشم': 'زردی از کبد. فوری آزمایش، اجتناب الکل.',
    'ساق پا': 'درد ساق از ورزش یا لخته خون. استراحت، اگر تورم سونوگرافی.',
    'بی‌حسی انگشت': 'بی‌حسی از آسیب اعصاب. قند چک کنید، متخصص غدد.',
    'کابوس': 'کابوس از استرس. مدیتیشن قبل خواب، روان‌درمانی.',
    'درد پستان': 'درد پستان از هورمون یا کیست. سونوگرافی، ماموگرافی اگر بالای ۴۰.',
    'آفت دهان': 'آفت از ویتامین یا استرس. ژل بنزیدام، اگر مکرر ایمونولوژی.',
    'درد شانه': 'درد شانه از استفاده زیاد. یخ بگذارید و استراحت، فیزیوتراپی.',
    'قند خون': 'قند بالا از رژیم یا دیابت. کربوهیدرات کم کنید، آزمایش قند طولانی.',
    'سردرد صبح': 'سردرد صبح از فشار یا آپنه خواب. فشار چک کنید، خواب منظم.',
    'خونریزی لثه': 'خونریزی لثه از پلاک. نخ دندان و مسواک نرم، دندانپزشک.',
    'درد کلیه': 'درد کلیه از سنگ یا عفونت. آب زیاد بنوشید، سونوگرافی.',
    'تپش قلب': 'تپش از کافئین یا استرس. نفس عمیق بکشید، نوار قلب اگر مداوم.',
    'چروک صورت': 'چروک از آفتاب یا سن. کرم ضدآفتاب و رتینول، متخصص پوست.',
    'درد زانو': 'درد زانو از آسیب یا آرتروز. استراحت، یخ، فشار، بالا بردن، عکس‌برداری.',
    'بثورات': 'بثورات از اگزما یا آلرژی. مرطوب‌کننده و کرم استروئید، پوست.',
    'خارش سر': 'خارش سر از شوره یا شپش. شامپو ضدشوره، اگر حشره درمان خاص.',
    'درد شکم راست': 'درد سمت راست از آپاندیسیت. فوری اورژانس، اگر شدید سونوگرافی.',
    'تاری دید': 'تاری دید از خستگی یا فشار چشم. استراحت، چشم‌پزشک.',
    'اضافه وزن': 'افزایش وزن از کم‌کاری تیروئید. رژیم و ورزش، آزمایش تیروئید.',
    'سرفه خلط': 'سرفه خلط‌دار از عفونت. هیدراته بمانید، اگر زرد آنتی‌بیوتیک.',
    'شست پا': 'درد شست از نقرس، اسید اوریک بالا. آب گیلاس، آزمایش.',
    'بی‌خوابی شب': 'بی‌خوابی از تغییر زمان. ملاتونین کم‌دوز، روتین.',
    'روده': 'نفخ از سندرم روده تحریک‌پذیر. فیبر متعادل، متخصص گوارش.',
    'سردی انگشت': 'درد سرد انگشتان از حساسیت به سرما. دستکش بپوشید، روماتولوژی.',
    'آبریزش چشم': 'آبریزش از آلرژی. قطره ضدآلرژی، اجتناب محرک.',
    'درد پهلو': 'درد پهلو از کلیه یا عضله. استراحت، اگر تب آزمایش.',
    'ریزش ناخن': 'ریزش ناخن از استرس یا آهن. بیوتین، آزمایش.',
    'درد فک': 'درد فک از مفصل فک. غذای نرم بخورید، دندانپزشک.',
    'خارش واژن': 'خارش از قارچ یا باکتری. بهداشت، متخصص زنان.',
    'سردرد ضربان': 'سردرد ضربان‌دار از میگرن. اکسیژن یا مسکن، متخصص.',
    'غدد لنفاوی': 'ورم از عفونت یا سرطان غدد. استراحت، اگر مداوم نمونه‌برداری.',
    'مچ دست': 'درد مچ از سندرم تونل. مچ‌بند، متخصص استخوان.',
    'تهوع بارداری': 'تهوع شدید بارداری. زنجبیل و غذای کوچک، پزشک زنان.',
    'بوی بدن': 'بوی بد از تعریق یا رژیم. دوش و دئودورانت، اگر شدید چک.',
    'درد چشم': 'درد پشت چشم از سینوزیت. بخار، متخصص گوش و حلق و بینی.',
    'ضعف پا': 'ضعف از ویتامین B12. سبزیجات برگ‌دار، آزمایش.',
    'جوش چرکی': 'جوش چرکی از باکتری. کمپرس گرم، اگر بزرگ تخلیه.',
    'تنفس سریع': 'تنفس سریع از حمله پانیک. کیسه کاغذی، روانپزشک.',
    'بیضه چپ': 'درد از التهاب. استراحت و آنتی‌بیوتیک، متخصص ادراری.',
    'خشکی واژن': 'خشکی از هورمون. لوسیون، متخصص زنان.',
    'استفراغ': 'سردرد با استفراغ از عفونت. فوری اورژانس، آزمایش مایع نخاعی.',
    'رنگ‌پریدگی': 'رنگ‌پریدگی از آهن کم. گوشت قرمز، آزمایش هموگلوبین.',
    'درد آرنج': 'درد آرنج از استفاده زیاد. استراحت و کشش، متخصص استخوان.',
    'خارش گوش': 'خارش از اگزما. قطره ملایم، متخصص گوش و حلق و بینی.',
    'ادرار شبانه': 'ادرار شبانه از پروستات. محدود مایعات عصر، متخصص ادراری.',
    'کف پا': 'درد کف پا از التهاب. کفش مناسب، فیزیوتراپی.',
    'لرزش صدا': 'لرزش از استرس یا تیروئید. آب گرم، آزمایش.',
    'زیر بغل': 'درد از غدد متورم. دئودورانت، اگر تورم ماموگرافی.',
    'بی‌حسی صورت': 'بی‌حسی از سکته. فوری اورژانس، تست سریع.',
    'درد لگن': 'درد لگن از آندومتریوز. مسکن، متخصص زنان.',
    'سرفه شب': 'سرفه شب از ریفلاکس یا آسم. بالش بالا، متخصص ریه.',
    'چربی خون': 'چربی بالا از رژیم. داروهای کاهنده و ورزش، آزمایش.',
    'درد زبان': 'درد زبان از ویتامین. ویتامین B، دندانپزشک.',
    'ورم صورت': 'ورم از آلرژی. آنتی‌هیستامین، اگر تنگی نفس اورژانس.',
    'خستگی غذا': 'خستگی از افت قند. پروتئین بخورید، چک قند.',
    'درد ران': 'درد ران از سیاتیک. استراحت و کشش، متخصص اعصاب.',
    'جوش پشت': 'جوش پشت از عرق. دوش منظم و کرم بنزوئیل، متخصص پوست.',
    'بی‌قراری': 'بی‌قراری از بیش‌فعالی یا اضطراب. روتین روزانه، روانشناس.',
    'درد مثانه': 'درد مثانه از عفونت. آب زیاد، آنتی‌بیوتیک، متخصص ادراری.',
    'حساسیت نور': 'سردرد با حساسیت از میگرن. اتاق تاریک، مسکن.',
    'ورم پلک': 'ورم پلک از التهاب. کمپرس گرم، چشم‌پزشک.',
    'سینه چپ': 'درد سینه چپ از درد قلبی. فوری نوار قلب، متخصص قلب.',
    'ریزش ابرو': 'ریزش ابرو از تیروئید. بیوتین، آزمایش.',
    'خارش بینی': 'خارش بینی از التهاب آلرژیک بینی. اسپری کورتیزون، متخصص گوش و حلق و بینی.',
    'فتق': 'درد شکم از فتق. اجتناب بلند کردن، جراح.',
    'آپنه': 'تنگی نفس خواب از آپنه. دستگاه تنفسی، متخصص خواب.',
    'انگشت اشاره': 'درد انگشت از انگشت ماشه‌ای. استراحت، متخصص استخوان.',
    'بوی ادرار': 'بوی بد از عفونت ادراری. آب زیاد، آزمایش ادرار.',
    'کج‌گردنی': 'درد گردن از کج‌گردنی. گرما و ماساژ، فیزیوتراپی.',
    'جوش سفید': 'جوش سفید از کیست کوچک. لایه‌برداری ملایم، متخصص پوست.',
    'ضعف دست': 'ضعف دست از سکته. فوری اورژانس.',
    'سوزش زبان': 'سوزش از سوزش دهان. ویتامین B، دندانپزشک.',
    'آرتریت': 'ورم زانو از آرتریت. یخ و مسکن ضدالتهاب، روماتولوژی.',
    'سر بچه': 'درد سر کودک از تب. پاراستامول، پزشک اطفال.',
    'خارش مقعد': 'خارش از بواسیر. فیبر و کرم، متخصص رکتوم.',
    'پرده ریه': 'درد با سرفه از التهاب پرده ریه. استراحت، متخصص ریه.',
    'ریزش مژه': 'ریزش از ریزش موضعی. کرم کورتیزون، متخصص پوست.',
    'تنفس بو': 'تنفس بد از بوی بد دهان. بهداشت دهان، دندانپزشک.',
    'درد راه رفتن': 'درد پا از درد عروقی. پیاده‌روی، متخصص عروق.',
    'جوش بازو': 'جوش از التهاب فولیکول مو. صابون ضدباکتری، متخصص پوست.',
    'بی‌حسی پا': 'بی‌حسی از آسیب اعصاب. قند چک کنید، متخصص اعصاب.',
    'سرگیجه چرخشی': 'سردرد با سرگیجه از سرگیجه چرخشی. حرکت اصلاحی، متخصص گوش و حلق و بینی.',
    'ورم لب': 'ورم لب از ورم عمیق. آنتی‌هیستامین، آلرژی.',
    'التهاب معده': 'درد با نفخ از التهاب معده. آنتی‌اسید، متخصص گوارش.',
    'خارش پا': 'خارش از قارچ پا. پودر ضدقارچ، متخصص پوست.',
    'تپش شب': 'تپش شب از نامنظمی ضربان. مانیتور قلب، نوار قلب.',
    'دندان عقل': 'درد از گیر کردن دندان. کشیدن، دندانپزشک.',
    'زونا': 'راش از زونا. داروهای ضدویروس، متخصص پوست.',
    'ضعف کلی': 'ضعف از کم‌خونی. آهن مکمل، آزمایش.',
    'سوزش چشم': 'سوزش از خشکی چشم. قطره اشک، چشم‌پزشک.',
    'درد لثه': 'درد لثه از التهاب پیشرفته. تمیزکاری، دندانپزشک.',
    'بی‌اشتهایی': 'بی‌اشتهایی از بی‌اشتهایی عصبی. مشاوره تغذیه، روانپزشک.',
    'ورم دست': 'ورم دست از تونل مچ. مچ‌بند، متخصص استخوان.',
    'خارش گلو': 'خارش از ترشح پشت حلق. اسپری نمکی، متخصص گوش و حلق و بینی.',
    'مثانه چپ': 'درد از سنگ کلیه. آب و مسکن، متخصص ادراری.',
    'جوش کیستیک': 'جوش کیستیک از آکنه. داروهای قوی، متخصص پوست.',
    'سرگیجه بلند': 'سرگیجه از افت فشار. نمک و آب، متخصص قلب.',
    'شانه چپ': 'درد از آسیب روتاتور. فیزیوتراپی، متخصص استخوان.',
    'بوی مو': 'بوی بد از چربی پوست سر. شامپو ضدچربی، متخصص پوست.',
    'تنگی ورزش': 'تنگی با ورزش از آسم. دستگاه تنفسی، متخصص ریه.',
    'انگشت کوچک': 'درد از شکستگی. آتل، متخصص استخوان.',
    'کهیر': 'راش از کهیر. آنتی‌هیستامین، آلرژی.',
    'خستگی مزمن': 'خستگی از خستگی طولانی. استراحت و ورزش، متخصص داخلی.',
    'سوزش پوست': 'سوزش از آسیب اعصاب. داروهای آرام‌بخش اعصاب، متخصص اعصاب.',
    'ورم بینی': 'ورم از التهاب بینی. داروهای بازکننده، متخصص گوش و حلق و بینی.',
    'پشت زانو': 'درد از کیست پشت زانو. سونوگرافی، متخصص استخوان.',
    'جوش پیشانی': 'جوش از آکنه هورمونی. قرص تنظیم هورمون، متخصص پوست.',
    'بی‌قراری پا': 'بی‌قراری از پا بی‌قرار. منیزیم، متخصص اعصاب.',
    'غضروف دنده': 'درد از التهاب غضروف دنده. مسکن ضدالتهاب، متخصص قلب.',
    'ریزش سکه': 'ریزش از ریزش موضعی. کرم کورتیزون، متخصص پوست.',
    'خارش داخل بینی': 'خارش از آلرژی. آنتی‌هیستامین، متخصص گوش و حلق و بینی.',
    'اضطراب': 'تپش از اضطراب. تنفس عمیق، روانپزشک.',
    'آندومتریوز': 'درد از آندومتریوز. مسکن، متخصص زنان.',
    'سردرد تنشی': 'سردرد تنشی از استرس. ماساژ و مسکن.',
    'غده بزاقی': 'ورم از التهاب غده بزاق. ماساژ و آنتی‌بیوتیک، متخصص گوش و حلق و بینی.',
    'ضعف بازو': 'ضعف از عصب فشرده. عکس‌برداری، متخصص اعصاب.',
    'بوی عرق': 'بوی بد از تعریق زیاد. تزریق بوتاکس، متخصص پوست.',
    'معده خالی': 'درد خالی از زخم معده. آنتی‌اسید، متخصص گوارش.',
    'خارش ران': 'خارش از قارچ. کرم ضدقارچ، متخصص پوست.',
    'نارسایی قلب': 'تنگی از نارسایی قلب. داروهای ادرارآور، متخصص قلب.',
    'شست کج': 'درد از برجستگی شست. کفش وسیع، متخصص استخوان.',
    'کهیر گرمایی': 'راش از کهیر گرمایی. آنتی‌هیستامین، متخصص پوست.',
    'بی‌حسی لب': 'بی‌حسی از حس غیرعادی. ویتامین B، متخصص اعصاب.',
    'ریفلاکس': 'سوزش از ریفلاکس اسید. آنتی‌اسید، متخصص گوارش.',
    'درد پشت سر': 'درد از درد عصب پس‌سر. بلوک عصبی، متخصص اعصاب.',
    'جوش بینی': 'جوش از روزاسه. کرم مترونیدازول، متخصص پوست.',
    'سرگیجه موضعی': 'سرگیجه از سرگیجه موضعی. حرکت جابجایی، متخصص گوش و حلق و بینی.',
    'ورم لنفاوی': 'ورم از ورم لنفاوی. جوراب فشاری، متخصص لنف.',
    'خستگی عصر': 'خستگی از خستگی غدد. کافئین متعادل، متخصص غدد.',
    'پیرچشمی': 'درد از پیری چشم. عینک، چشم‌پزشک.',
    'بوی بینی': 'بوی بد از سینوزیت. شستشو، متخصص گوش و حلق و بینی.',
    'صدای تنفس': 'تنفس صدادار از صدای تنفس. دستگاه بخور، اورژانس.',
    'گیر شانه': 'درد از گیر کردن شانه. فیزیوتراپی، متخصص استخوان.',
    'ریزش زایمان': 'ریزش از ریزش بعد زایمان. بیوتین، متخصص زنان.',
    'خارش دست': 'خارش از تعریق کف دست. کرم استروئید، متخصص پوست.',
    'تپش ورزش': 'تپش از ضربان سریع. داروهای آرام‌کننده قلب، متخصص قلب.',
    'دندان جلو': 'درد از پوسیدگی. پر کردن، دندانپزشک.',
    'عفونت پوستی': 'راش از عفونت پوستی. آنتی‌بیوتیک، متخصص پوست.',
    'ضعف صبح': 'ضعف از ضعف عضلانی. تست آنتی‌بادی، متخصص اعصاب.',
    'سوزش انگشت': 'سوزش از تونل مچ. جراحی، متخصص استخوان.',
    'ورم زبان': 'ورم از ورم عمیق. اپی‌نفرین، آلرژی.',
    'استرس معده': 'درد از روده تحریک‌پذیر. پروبیوتیک، متخصص گوارش.',
    'خارش آرنج': 'خارش از اگزما. مرطوب‌کننده، متخصص پوست.',
    'آسم سرد': 'تنگی از آسم سرد. گرم نگه داشتن، متخصص ریه.',
    'مچ پا': 'درد از پیچ‌خوردگی. استراحت، یخ، فشار، بالا بردن، متخصص استخوان.',
    'جوش زیر بغل': 'جوش از التهاب غدد عرق. آنتی‌بیوتیک، متخصص پوست.',
    'پرش چشم': 'بی‌قراری از اسپاسم پلک. تزریق بوتاکس، چشم‌پزشک.',
    'بوی خاص': 'سردرد از محرک میگرن. اجتناب محرک، متخصص اعصاب.',
    'پولیپ': 'ورم از پولیپ بینی. کرم کورتیزون، متخصص گوش و حلق و بینی.',
    'خستگی سرما': 'خستگی از کم‌کاری تیروئید. داروی تیروئید، متخصص غدد.',
    'پشت ران': 'درد از کشیدگی عضله ران. استراحت، فیزیوتراپی.',
    'بوی واژن': 'بوی بد از عفونت باکتریایی واژن. مترونیدازول، متخصص زنان.',
    'تنفس سطحی': 'تنفس از تنفس بیش از حد. کیسه کاغذی، روانپزشک.',
    'آرتروز ران': 'درد از آرتروز. مسکن ضدالتهاب، روماتولوژی.',
    'حساسیت آفتاب': 'راش از حساسیت به نور. ضدآفتاب، متخصص پوست.'
}

# ==========================================
# کلاس‌های API
# ==========================================

class DoctorListAPI(APIView):
    def get(self, request):
        doctors = Doctor.objects.all()
        serializer = DoctorSerializer(doctors, many=True, context={'request': request})
        return Response(serializer.data)

class ReserveAPI(APIView):
    def post(self, request):
        return Response({'message': 'نوبت با موفقیت ثبت شد (شبیه‌سازی)'}, status=status.HTTP_201_CREATED)

class MyAppointmentsAPI(APIView):
    def get(self, request):
        return Response([], status=status.HTTP_200_OK)

class AIChatAPI(APIView):
    authentication_classes = [] 
    permission_classes = [AllowAny]

    def post(self, request):
        user_message = request.data.get('message', '')
        
        if not user_message:
            return Response({'response': "لطفاً سوال خود را بنویسید."})

        text = user_message.lower()
        ai_response = ""
        found = False

        # جستجوی هوشمند کلمه کلیدی در جمله کاربر
        for keyword, answer in MEDICAL_KNOWLEDGE.items():
            if keyword in text:
                ai_response = answer
                found = True
                break
        
        if not found:
            ai_response = "متاسفانه پاسخ این سوال را نمی‌دانم. لطفاً سوال خود را به شکل دیگری بپرسید یا با کلمات کلیدی مثل 'سردرد'، 'دل‌درد' و... امتحان کنید."

        return Response({'response': ai_response})
